# Рекомендации по развёртыванию и сопровождению сервиса
## Переменные окружения
Перед запуском приложения необходимо установить следующие переменные окружения:

* DATABASE_URL - адрес, по которому расположена база данных
* JWT_EXPIRE_TIME - время, через которое истекает срок годности JWT. Устанавливается в минутах. По умолчанию: 30
* RSA_PRIVATE_DIR - директория, в которой содержится приватный ключ. По умолчанию: './'
* RSA_PUBLIC_DIR - директория, в которой содержатся публичные ключи сервисов, которые будут обращаться к текущему сервису. По умолчанию: './'
* SERVICE_NAME - название сервиса. Используется в качестве изготовителя в генерируемых токенах. По умолчанию: 'idp'

## Генерация и размещение ключей
Для корректной работы сервиса необходимо сгенерировать пару RSA-ключей для данного сервиса. 
Приватный ключ должен быть назван "private.pem" и размещаться в директории, указанной в переменной RSA_PRIVATE_DIR.
Публичный ключ должен быть назван "#{SERVICE_NAME}.pem" и быть передан всем сервисам-потребителям, с которыми будет вестись работа.

## Размещение публичных ключей сервисов-потребителей
Публичные ключи всех сервисов-потребителей, которым требуется аутентификация пользователя, должны быть размещены в директории RSA_PUBLIC_DIR.
Имена публичных ключей должны совпадать с именами сервисов, т.е. "#{ИМЯ_СЕРВИСА}.pem" 

## Совершение запросов к IDP
* Каждый запрос к IDP должен сопровождаться JWT-токеном, содержащим:
    * Имя сервиса в поле 'iss'
    * Адрес, по которому необходимо предоставить ответ, в поле 'callback_url'
* Каждый запрос должен в параметрах содержать адрес, по которому можно повторить данный запрос. Необходим для успешного завершения регистрации, а также может пригодиться для возврата пользователя, если что-то пошло не так.
* Запросы к IDP должны совершаться по следующим адресам:
    * Вход: '/auth/sso/jwt/login'
    * Выход: '/auth/sso/jwt/logout'
